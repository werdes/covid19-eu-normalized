function displayData(e,a){var t=new Array;Object.keys(e).forEach(function(a){var n=e[a];if(n.reachedThreshold){var o=new Array;Object.keys(n.byDay).forEach(function(e){var a=1+Math.round((new Date(e)-n.reachedThresholdAt)/864e5),t=new Date(e);t.setDate(t.getDate()-n.dayDiffToLowest),o.push({x:t,real:new Date(e),daysSinceStart:a,region:n,y:n.byDay[e]})}),t.push({name:a,data:o})}}),$("#loading-indicator").addClass("d-none"),Highcharts.chart("chart",getChartOptions(a,t))}function loadJHCSSEConfirmed(e){loadJHCSSE(e,"https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Confirmed.csv")}function loadJHCSSEDeaths(e){loadJHCSSE(e,"https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Deaths.csv")}function loadJHCSSE(e,a){var t=null,n="([0-9]{1,2}/[0-9]{1,2}/[0-9]{1,2})\\w+",o={};$.get({url:a,cache:!0,complete:function(a){var r=a.responseText.replace("\r","").split("\n"),s={},i=r[0],c=i.split(",");c.forEach(function(e,a){if(e.match(n)){var t=new Date(e),o=t.getFullYear()+"/"+("0"+(t.getMonth()+1)).slice(-2)+"/"+("0"+t.getDate()).slice(-2);s[o]=a}}),r.shift(),r.forEach(function(e,a){var n=e.split(","),r=n[1];o[r]||(o[r]={country:r,reachedThresholdAt:null,reachedThreshold:!1,dayDiffToLowest:0,fullCaseCount:0,byDay:{}});var i=o[r];Object.keys(s).forEach(function(e){var a=s[e],o=parseInt(n[a]),r=new Date(e);i.byDay[e]||(i.byDay[e]=0),i.byDay[e]+=o,o>=100&&(i.reachedThreshold||(i.reachedThresholdAt=r),i.reachedThreshold=!0,o>i.fullCaseCount&&(i.fullCaseCount=o)),(null==t||t>r)&&(t=r)})}),Object.keys(o).forEach(function(e){var a=o[e];a.dayDiffToLowest=Math.round((a.reachedThresholdAt-t)/864e5)}),$("body").append("<textarea>"+JSON.stringify(o)+"</textarea>"),e(o,t)}})}function loadIsaacLin(e){var a=null;$.get({url:"https://raw.githubusercontent.com/BlankerL/DXY-COVID-19-Data/master/json/DXYArea-TimeSeries.json",cache:!0,dataType:"json",complete:function(t){var n={};t.responseJSON.forEach(function(e,t){if(e.countryEnglishName&&e.provinceEnglishName==e.countryEnglishName&&"Europe"==e.continentEnglishName){n[e.countryEnglishName]||(n[e.countryEnglishName]={country:e.countryEnglishName,reachedThresholdAt:null,reachedThreshold:!1,dayDiffToLowest:0,snapshots:new Array,fullCaseCount:0,byDay:{}});var o=n[e.countryEnglishName];if(o.snapshots.push(e),e.confirmedCount>=100){if(o.reachedThreshold=!0,null==o.reachedThresholdAt||o.reachedThresholdAt>new Date(e.updateTime)){var r=new Date(e.updateTime);o.reachedThresholdAt=r,(null==a||a>r)&&(a=r)}o.fullCaseCount<e.confirmedCount&&(o.fullCaseCount=e.confirmedCount)}}}),Object.keys(n).forEach(function(e){var t=n[e];t.dayDiffToLowest=Math.round((t.reachedThresholdAt-a)/864e5),t.reachedThreshold&&(t.snapshots.sort(function(e,a){return e.updateTime-a.updateTime}),t.snapshots.forEach(function(e){var a=new Date(e.updateTime),n=a.getFullYear()+"/"+("0"+(a.getMonth()+1)).slice(-2)+"/"+("0"+a.getDate()).slice(-2);t.byDay[n]||(t.byDay[n]=e.confirmedCount),t.byDay[n]<e.confirmedCount&&(t.byDay[n]=e.confirmedCount)}),t.snapshots=null)}),e(n,a)}})}function getChartOptions(e,a){return{chart:{zoomType:"xy"},title:{text:""},yAxis:{title:{text:"confirmed cases"}},xAxis:{labels:{align:"left",formatter:function(){return""}}},legend:{layout:"vertical",align:"right",verticalAlign:"middle"},tooltip:{headerFormat:"",useHtml:!0},plotOptions:{series:{label:{connectorAllowed:!1},pointStart:e}},series:a,responsive:{rules:[{condition:{maxWidth:500},chartOptions:{legend:{layout:"horizontal",align:"center",verticalAlign:"bottom"}}}]}}}$(function(){loadIsaacLin(displayData)});var _ENUM_SOURCES={ISAAC_LIN:0,JOHN_HOPKINS_CSSE_CONFIRMED:1,JOHN_HOPKINS_CSSE_DEATHS:2};$("input[name=source]").change(function(){switch($("#loading-indicator").removeClass("d-none"),$(this).val()){case"isaac-lin":loadIsaacLin(displayData);break;case"john-hopkins-csse-confirmed":loadJHCSSEConfirmed(displayData);break;case"john-hopkins-csse-deaths":loadJHCSSEDeaths(displayData)}}),Highcharts.Point.prototype.tooltipFormatter=function(e){var a=this,t=a.real.getFullYear()+"/"+("0"+(a.real.getMonth()+1)).slice(-2)+"/"+("0"+a.real.getDate()).slice(-2);return"<b>"+a.region.country+" </b> | Day "+a.daysSinceStart+"<br/>"+a.y+" confirmed cases<br />Offset: "+a.region.dayDiffToLowest+" days<br/>"+t};